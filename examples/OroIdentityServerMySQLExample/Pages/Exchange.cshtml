@page
@model ExchangeModel
@{
    ViewData["Title"] = "Token Exchange";
}

<div class="text-center">
    <h1 class="display-4">Tokens Received</h1>
    @if (Model.AccessToken != null)
    {
        <p><strong>Access Token:</strong> @Model.AccessToken</p>
        <p><strong>ID Token:</strong> @Model.IdToken</p>
        <p><strong>Refresh Token:</strong> @Model.RefreshToken</p>
        <p><a href="/userinfo" class="btn btn-info">Get User Info</a></p>
    }
    else if (Model.RequiresCodeVerifier)
    {
        <div class="alert alert-warning">
            <p><strong>PKCE Required:</strong> This authorization code was issued with PKCE (Proof Key for Code Exchange).</p>
            <p>Please enter the <code>code_verifier</code> that was generated by your client application.</p>
        </div>
        
        <form method="post" class="mt-4">
            <input type="hidden" name="code" value="@Model.Code" />
            <input type="hidden" name="state" value="@Model.State" />
            
            <div class="mb-3">
                <label for="codeVerifier" class="form-label">Code Verifier</label>
                <input type="text" class="form-control" id="codeVerifier" name="codeVerifier" 
                       placeholder="Enter the code_verifier from your client app" required />
                <div class="form-text">
                    This is the secret value generated by your OAuth client when creating the PKCE challenge.
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary">Exchange Code for Tokens</button>
        </form>
        
        <div class="mt-4">
            <h5>How to get the code_verifier:</h5>
            <ul class="text-start d-inline-block">
                <li>If using the PKCE console example: Copy it from the console output</li>
                <li>If building your own client: Use the same code_verifier that generated the code_challenge</li>
                <li>The code_verifier should be a random string of 43-128 characters</li>
            </ul>
        </div>
    }
    else
    {
        <p>Error: @Model.Error</p>
    }
</div>